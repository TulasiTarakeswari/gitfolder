deploy:
  name: Deploy to Minikube
  needs: build
  runs-on: self-hosted

  steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Set up JDK 21
      uses: actions/setup-java@v4
      with:
        java-version: '21'
        distribution: 'temurin'

        

    - name: Build again locally (avoid artifact download)
      run: mvn clean install

    - name: Set up Kubeconfig for Minikube
      run: |
        echo "${{ secrets.KUBECONFIG_DATA }}" | base64 -d > kubeconfig
        mkdir -p $HOME/.kube
        mv kubeconfig $HOME/.kube/config

    - name: Verify Cluster Access
      run: kubectl get nodes --kubeconfig=$HOME/.kube/config

    - name: Deploy to Kubernetes
      run: |
        kubectl apply -f Deployment.yml --kubeconfig=$HOME/.kube/config
        kubectl apply -f Service.yml --kubeconfig=$HOME/.kube/config
